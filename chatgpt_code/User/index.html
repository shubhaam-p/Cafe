<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR-Based Food Ordering</title>
    <link rel="stylesheet" href="CSS/styles.css" />
    <link rel="stylesheet" href="CSS/bootstrap.min.css" >


    <header id="header-mobile" class="light fixed-top">
      <div class="module module-logo">
          <a href="index.html">
              <img src="assets/img/mobile-logo.jpeg" alt="">
          </a>
      </div>
  </header>
  </head>

  <body>
    <div class="content">
      <div id="menu-header" class="page-title">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 offset-lg-4">
                    <div class="mb-0 main">Our Menu</div>
                    <div class="mb-0 sub-title">The Taste of Mumbai in Every Bite!</div>
                </div>
            </div>
        </div>
      </div>

      <div id="menu" class="custom-container">

        <div id="menu-list" class="d-flex justify-content-between flex-wrap categories-div p-2"></div>
        <div class="action-buttons" data-page="cart">
          <button onclick="viewCart()">View Cart</button>
        </div>
      </div>

        <div class="custom-container" id="category-nav-container">
          <div class="col-12 navbar-menu-category fixed-top">
            <div class="order-title">
              <div class="main">Order</div>
            </div>
              <div class="menu-category d-flex flex-nowrap">
                <div class="nav-item-category text-nowrap active" category-id="13" category-name="misal-pav" id="misal-pav">Misal Pav</div>
                <div class="nav-item-category text-nowrap" category-id="12" category-name="samosa" id="samosa">Samosa</div>
                <div class="nav-item-category text-nowrap" category-id="15" category-name="pav-bhaji" id="pav-bhaji">Pav Bhaji</div>
                <div class="nav-item-category text-nowrap" category-id="14" category-name="sandwiches" id="sandwiches">Sandwiches</div>
                <div class="nav-item-category text-nowrap" category-id="16" category-name="drinks" id="drinks">Drinks</div>
                <div class="nav-item-category text-nowrap" category-id="17" category-name="chai" id="chai">Chai</div>
                <div class="nav-item-category text-nowrap" category-id="18" category-name="bhel" id="bhel">Mumbaiya Bhel</div>
              </div>
          </div>
          <div id="menu-category-wise-list" class="row"></div>
        </div>

      <div id="search" class="custom-container">
        <div class="col-12 fixed-top">
          <div class="search-title">
            <div class="main">Search</div>
          </div>
        </div>
        <div id="search-body" class="px-3">
          <div class="input-group mb-2" id="search-bar-container">
            <input type="text" class="form-control" id="search-bar" placeholder="Username">
            <div class="input-group-append">
              <div class="input-group-text"><img src="assets/search.svg" alt="offers"></div>
            </div>
          </div>
          <div id="search-list"></div>
        </div>
      </div>

      <div class="home-cart fixed-bottom">
        <div class="mob-footer">
          <div role="presentation" id="home-nav-item" onclick="loadPage('home')" class="nav-item u_cursor_pointer active" data-page="home">
            <img src="assets/home.svg" alt="home">
            <p class="mob-footer-label takeaway">Home</p>
          </div>
          <div role="presentation" id="menu-nav-item" class="nav-item u_cursor_pointer" data-page="menu">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-bag" viewBox="0 0 16 16">
              <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1m3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/>
            </svg>
            <p class="mob-footer-label ">Menu</p>
          </div>
          <div role="presentation" id="search-nav-item" class="nav-item u_cursor_pointer" onclick="loadPage('search')" data-page="search">
            <img src="assets/search.svg" alt="search">
            <p class="mob-footer-label ">Search Menu</p>
          </div>
          <div role="presentation" id="cart-nav-item" class="nav-item u_cursor_pointer" onclick="loadPage('cart')" data-page="cart">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
              <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l1.313 7h8.17l1.313-7zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
            </svg>
            <p class="mob-footer-label">Cart</p>
          </div>
        </div>
      </div>

      <div id="cart" class="custom-container">
        <h3>Your Order</h3>
        <div id="cart-list"></div>
        <h5>Total: â‚¹<span id="cart-total">0</span></h5>
        <div class="action-buttons">
          <button id="place-order" onclick="placeOrder()" disabled>
            Place Order
          </button>
          <button class="bg-dark" onclick="loadPage('menu')">Back to Menu</button>
        </div>
      </div>

      <div id="order-success" class="custom-container">
        <h1>Order Placed Successfully!</h1>
        <p>Thank you for your order.</p>
        <div class="action-buttons">
          <button onclick="goBack(true); loadPage('menu')">Back to Menu</button>
        </div>
      </div>
</body>
<script src="js/jquery-3.7.1.js" ></script>

      <script>
        const menuItems = [
          {
            id: 1,
            name: "Samosa",
            price: 5,
            desc: "Juicy grilled burger with cheese",
            img: "assets/img/item1.jpg",
            category_id: 12,
            category: "Samosa"
          },
          {
            id: 2,
            name: "Misal Pava",
            price: 8,
            desc: "Delicious cheesy pizza with toppings",
            img: "assets/img/item1.jpg",
            category_id: 13,
            category: "misal-pav"
          },
          {
            id: 3,
            name: "Sandwich",
            price: 7,
            desc: "Creamy Alfredo pasta with herbs",
            img: "assets/img/item1.jpg",
            category_id: 14,
            category: "sandwiches"
          },
          {
            id: 4,
            name: "Sp. pav bhaji",
            price: 4,
            desc: "Fresh garden salad with dressing",
            img: "assets/img/item1.jpg",
            category_id: 15,
            category: "pav-bhaji"
          },
          {
            id: 5,
            name: "Btr pav bhaji",
            price: 4,
            desc: "Fresh garden salad with dressing",
            img: "assets/img/item1.jpg",
            category_id: 15,
            category: "pav-bhaji"
          },
          {
            id: 6,
            name: "Btr bhel",
            price: 4,
            desc: "Fresh garden salad with dressing",
            img: "assets/img/item1.jpg",
            category_id: 18,
            category: "bhel"
          },
          {
            id: 7,
            name: "Btr bhel",
            price: 4,
            desc: "Fresh garden salad with dressing",
            img: "assets/img/item1.jpg",
            category_id: 18,
            category: "bhel"
          },
        ];

        let cart = [];
        let search = [];
        let currentPage = "";
        let defaultCategory = 13;
        
        function showHideSections(section) {
          idArray = ["menu-header", "menu-list", "category-nav-container","search","cart","menu","order-success"]
          idArray.forEach((id)=>{
            if(section.includes(id) && $('#'+id+':visible').length == 0 ){
              if(id=='menu-list')
                document.getElementById(id).setAttribute("style","display: flex !important");
              else
                document.getElementById(id).setAttribute("style","display: block !important");

            }else if(!section.includes(id) && $('#'+id+':visible').length == 1){
              document.getElementById(id).setAttribute("style","display: none !important");
            }

          })
        }
        function displayMenu2(category_id = '') {
          document.getElementById('menu-nav-item').click();
          showHideSections(['category-nav-container'])

          const menuList = document.getElementById("menu-category-wise-list");
          menuList.innerHTML = "";
          menuCategory = menuItems;
         category_id = parseInt(category_id);
          let found = menuItems.find((item) => item.category_id === category_id);
          if(!found){
            let div = document.createElement("div");
            div.innerHTML = '<div>Category not found</div>';
            menuList.append(div)
            return;
          }
          menuCategory = menuItems.filter((item) => item.category_id === category_id);
  
          menuCategory.forEach((item, index) => {
            let found = cart.find((cartItem) => cartItem.id === item.id);
            let quantity = found ? found.quantity : 0;
            let div = document.createElement("div");
            // div.classList.add("menu-item");
            div.classList.add("col-12");
            div.classList.add("col-md-6");
            div.innerHTML = `
                    <div class="cardd row mb-2">
                      <div class="col-4 col-md-4">
                        <img width="96" height="96" class="br-item" alt="${item.name}" src="${item.img}">
                      </div>
                      <div class="cardd-body col-8 col-md-8">
                        <div class="cardd-details">
                          <div class="cardd-title fs-20 fw-600">${item.name}</div>
                          <div>
                            <p class="cardd-text fs-15"> ${item.desc} </p>
                          </div>
                        </div>
                        <div class="cardd-footer-custom">
                          <div class="left-item">
                            <span class="fw-600"> â‚¹${item.price}</span>
                          </div>
                        
                          <div class="menuu-actions">
                              ${
                                quantity > 0
                                  ? `<div class='quantity'>
                                      <button onclick='updateMenuQuantity(${item.id}, -1, "${item.category_id}")'>-</button>
                                      <span>${quantity}</span>
                                      <button onclick='updateMenuQuantity(${item.id}, 1, "${item.category_id}")'>+</button>
                                  </div>`
                                  : `<button class='add-btn' onclick='updateMenuQuantity(${item.id}, 1, "${item.category_id}")'>Add</button>`
                              }
                          </div>
                          </div>
                        </div>
                      </div>`;
            menuList.appendChild(div);
          });
        }

        function displayMenu() {
          document.getElementById('home-nav-item').click();
          
          showHideSections(['menu-list','menu-header','menu'])

          const menuList = document.getElementById("menu-list");
          menuList.innerHTML = "";

          menuItems.forEach((item, index) => {
            let div = document.createElement("div");
            div.classList.add("item-category");
            div.setAttribute("category-id", `${item.category_id}`);
            // div.setAttribute("data-page", "menu");
            div.innerHTML = `
                            <img width="96" height="96" class="br-item" alt="${item.name}" src="${item.img}">
                            <p>${item.category}</p>
                            `;
            menuList.appendChild(div);
          });
        }

        function searchItem() {
          document.getElementById('search-nav-item').click();
          showHideSections(['search'])
          const searchList = document.getElementById("search-list");
          searchList.innerHTML = "";

          search.forEach((item, index) => {
            let div = document.createElement("div");
            div.classList.add("cart-item");
            div.classList.add("col-12");
            div.classList.add("col-md-6");
            let quantity = item.quantity ? item.quantity : 0;
            div.innerHTML = `
                    <div class="cardd row mb-2">
                      <div class="col-4 col-md-4">
                        <img width="96" height="96" class="br-item" alt="${item.name}" src="${item.img}">
                      </div>
                      <div class="cardd-body col-8 col-md-8">
                        <div class="cardd-details">
                          <div class="cardd-title fs-20 fw-600">${item.name}</div>
                          <div>
                            <p class="cardd-text fs-15"> ${item.desc} </p>
                          </div>
                        </div>
                        <div class="cardd-footer-custom">
                          <div class="left-item">
                            <span class="fw-600"> â‚¹${item.price}</span>
                          </div>
                        
                           <div class="menuu-actions">
                              ${
                                quantity > 0
                                  ? `<div class='quantity'>
                                      <button onclick='updateMenuQuantity(${item.id}, -1, "${item.category_id}",1)'>-</button>
                                      <span>${quantity}</span>
                                      <button onclick='updateMenuQuantity(${item.id}, 1, "${item.category_id}",1)'>+</button>
                                  </div>`
                                  : `<button class='add-btn' onclick='updateMenuQuantity(${item.id}, 1, "${item.category_id}",1)'>Add</button>`
                              }
                          </div>
                        </div>
                      </div>`;
            searchList.appendChild(div);
          });
        }


      // Search bar -- results
      $(document).ready(function () {
          $("#search-bar").on("keyup", function () {
              let value = $(this).val().trim().toLowerCase();
              if(value != '')
                search = menuItems.filter(item => item.name.toLowerCase().includes(value));
              else
                search = [];
              searchItem();
          });
      });




        function viewCart() {
          document.getElementById('cart-nav-item').click();
          showHideSections(['cart'])

          const cartList = document.getElementById("cart-list");
          const placeOrderBtn = document.getElementById("place-order");

          cartList.innerHTML = "";

          if (cart.length === 0) {
            cartList.innerHTML =
              "<p>Your cart is empty. Please select items from the menu.</p>";
            document.getElementById("cart-total").innerText = "0";

            placeOrderBtn.disabled = true;
            placeOrderBtn.classList.add("disabled-btn"); // Apply gray effect
            return;
          }

          let total = 0;
          cart.forEach((item, index) => {
            total += item.price * item.quantity;
            let div = document.createElement("div");
            div.classList.add("cart-item");
            div.classList.add("col-12");
            div.classList.add("col-md-6");
            div.innerHTML = `
                    <div class="cardd row mb-2">
                      <div class="col-4 col-md-4">
                        <img width="96" height="96" class="br-item" alt="${item.name}" src="${item.img}">
                      </div>
                      <div class="cardd-body col-8 col-md-8">
                        <div class="cardd-details">
                          <div class="cardd-title fs-20 fw-600">${item.name}</div>
                          <div>
                            <p class="cardd-text fs-15"> ${item.desc} </p>
                          </div>
                        </div>
                        <div class="cardd-footer-custom">
                          <div class="left-item">
                            <span class="fw-600"> â‚¹${item.price}</span>
                          </div>
                        
                          <div class="menuu-actions">
                              <div class='quantity'>
                                  <button onclick='updateQuantity(${index}, -1)'>-</button>
                                  <span>${item.quantity}</span>
                                  <button onclick='updateQuantity(${index}, 1)'>+</button>
                              </div>
                          </div>
                        </div>
                      </div>`;
            cartList.appendChild(div);
          });

          document.getElementById("cart-total").innerText = total;

          // Enable button and remove gray effect
          placeOrderBtn.disabled = false;
          placeOrderBtn.classList.remove("disabled-btn");
        }

        function findItemById(id, object){
           return object.find((item)=>item.id== id)
        }

        function updateMenuQuantity(id, change, category_id, searchPage= 0) {
          let found = findItemById(id, cart)
          if(!found){
            found = findItemById(id, menuItems); 
            index = menuItems.findIndex(x => x.id === id);
          }

          if(found?.quantity) {
            found.quantity += change;
            
            if(searchPage)
              menuItems[index].quantity += change;

            if (found.quantity <= 0) {
              cart = cart.filter((item) => item.name !== found.name);
            }
          } 
          else if (change > 0) {
            if(searchPage)
              menuItems[index].quantity = 1;
            cart.push({ ...menuItems[index], quantity: 1 });
          }

          if(searchPage)
            searchItem()
          else
            displayMenu2(category_id);
        }

        function updateQuantity(index, change, searchPage) {
          cart[index].quantity += change;
          if (cart[index].quantity <= 0) {
            cart.splice(index, 1);
          }
          if(searchPage)
            searchItem()
          else
          viewCart();
        }

        function goBack(reset = false) {
          if (reset) {
            cart = []; // Reset cart only when coming from the order success page
          }
        }

        function placeOrder() {
          cart = [];
          showHideSections(['order-success'])
        }

        //For footer nav-bar
        const navLinks = document.querySelectorAll('.nav-item');
        navLinks.forEach(e =>{
          e.addEventListener('click',()=>{
            if(e.getAttribute('id') == 'menu-nav-item'){
              $('.nav-item-category[category-id="'+defaultCategory+'"]').click()
              $('.menu-category').animate({scrollLeft: $('.nav-item-category[category-id="'+defaultCategory+'"').position().left}, 300);
            }
            document.querySelector('.nav-item.active')?.classList.remove('active');
            e.classList.add('active');
          })
        })
        
        // for menu page
        const navCategory = document.querySelectorAll('.nav-item-category');
        navCategory.forEach(e =>{
          e.addEventListener('click',()=>{
            const categoryId = $(e).attr('category-id')?.trim();
            if(categoryId > 0){
              displayMenu2(categoryId);
              loadPage('menu', true, true)
            }
            document.querySelector('.nav-item-category.active')?.classList.remove('active');
            e.classList.add('active');
          })
        })

        $(document).on("click", '.item-category' ,function() {
          const categoryId = $(this).attr('category-id')?.trim();
          $('.nav-item-category[category-id="'+categoryId+'"]').click()
              // For scrolling in menu page
              $('.menu-category').animate({scrollLeft: $('.nav-item-category[category-id="'+categoryId+'"').position().left}, 300);
        }); 

        function loadPage(page, push=true, doNotLoad = false){
          //page- name, push - push to history, doNotLoad - if page is already loaded for not loading it again, then set it to true
          let pageExists = true;
          if(page == currentPage){
            console.log("return no -load page")
            return;
          }

          if((pageExists && push) || doNotLoad){
            currentPage = page;
            console.log("push state")
            history.pushState({ page }, "", `#${page}`);
          }

          // Reset search bar
          if(page != 'search' && $("#search-bar").val().trim() != ''){
            $("#search-bar").val('')
            $("#search-bar").trigger('keyup')
          }

          if(!doNotLoad){
            if(page == 'home'){
             displayMenu() 
             pageExists = true;
            }else if(page == 'menu'){
              displayMenu2(defaultCategory)
             pageExists = true;
  
            }else if(page == 'search'){
              searchItem()
              pageExists = true;
  
            }else if(page == 'cart'){
              viewCart();
             pageExists = true;
  
            }
          }

         
        }

        window.addEventListener("popstate", function (event) {
          console.log("-----------popstate ",event.state?.page);
            if (event.state) {
                loadPage(event.state.page, false);
            }else {
                if (history.length > 1) {
                    history.back(); // Let the browser handle it if possible
                } else {
                    window.location.href = "about:blank"; // Exit to a blank page
                }
            }

        });

        $(document).ready(function () {
            let hash = window.location.hash.substring(1);
            loadPage(hash || "home");
        });
      </script>
  <script src="js/bootstrap.bundle.min.js"></script>
</html>
